#!/usr/bin/env python
# ARP scan Networks 
from subprocess import Popen, PIPE
import time
import commands

import sys

netA=sys.argv[1]
netB=sys.argv[2]
netC=sys.argv[3]
iface=sys.argv[4]
file_net=sys.argv[5]
num_nets_enum=sys.argv[6]


#print "Using ",iface
#print "writing ",file_net

#clean IP
commands.getstatusoutput("ifconfig "+iface+" 0.0.0.0")


# networks 10.0.X.0
for ip in range(0,int(num_nets_enum)+1):
	network=netA.replace("X",str(ip) )	
	print "\tEscaneando %s " %(network)
	subprocess = Popen(['/usr/bin/arp-scan', iface, network], stdin=PIPE, stdout=PIPE, stderr=PIPE)
	stdout, stderr= subprocess.communicate(input=None) # obtener flujo de salida
	#print stdout
	#time.sleep(1) 
	if "10.0" in stdout:   # <<<< ##################################  Modificar ###
		print "\t\t >>>>>> Hurra!! encontre hosts aqui :) ("+network+") <<<<<<<\n"
		with open(file_net, "a") as myfile:
			myfile.write(network+'\n')
	else:
		print "\t\tNO, Aqui no hay hosts :( ("+network+")\n"


	

# networks 172.16.X.0/24
for ip in range(0,int(num_nets_enum)+1):
	network=netB.replace("X",str(ip) )
	print "\tEscaneando %s " %(network)
	subprocess = Popen(['/usr/bin/arp-scan', iface, network], stdin=PIPE, stdout=PIPE, stderr=PIPE)
	stdout, stderr= subprocess.communicate(input=None) # obtener flujo de salida
	#print stdout
	#time.sleep(1) 
	if "172.16" in stdout:   # <<<< ##################################  Modificar ###
		print "\t\t >>>>>> Hurra!! encontre hosts aqui :)  ("+network+") <<<<<<<\n"
		with open(file_net, "a") as myfile:
			myfile.write(network+'\n')
	else:
		print "\t\tNO, Aqui no hay hosts :( ("+network+")\n"
		
		
# CLASS C
for ip in range(0,int(num_nets_enum)+1):
	network=netC.replace("X",str(ip) )
	print "\tEscaneando %s " %(network)
	subprocess = Popen(['/usr/bin/arp-scan', iface, network], stdin=PIPE, stdout=PIPE, stderr=PIPE)
	stdout, stderr= subprocess.communicate(input=None) # obtener flujo de salida
	#print stdout
	#time.sleep(1) 
	if "192.168" in stdout:   # <<<< ##################################  Modificar ###
		print "\t\t >>>>>> Hurra!! encontre hosts aqui :) ("+network+") <<<<<<<\n"
		with open(file_net, "a") as myfile:
			myfile.write(network+'\n')
	else:
		print "\t\tNO, Aqui no hay hosts :( ("+network+")\n"

