#!/usr/bin/env perl
use strict; 
use warnings;
use Data::Dumper;
no warnings 'uninitialized';

my $ip_list = $ARGV[0]; # IP list

open (SALIDA,">>../reportes/reporte-OS.txt") || die "ERROR: No puedo abrir el fichero\n";
	print SALIDA "IP;NOMBRE;DOMINIO;GRUPO TRABAJO;S.O.\n";
	close (SALIDA);

open (MYINPUT,"<$ip_list") || die "ERROR: Can not open the file $ip_list\n";
while (my $ip=<MYINPUT>)
{ 
$ip =~ s/\n//g; 
my $Server = '';
 # if (-e "$ip.txt")
  #{
	#Extraer nombre de equipo:
	my $name = `grep --color=never "Computer name" $ip.txt`;
	$name =~ s/\n//g; 	
	$name =~ s/|   Computer name://g; 
	 
	
	#Extraer Workgroup:
	my $Workgroup = `grep --color=never "Workgroup" $ip.txt`;
	$Workgroup =~ s/\n//g; 	
	$Workgroup =~ s/|   Workgroup://g; 
	
	#Extraer dominio:
	my $domain = `grep --color=never "Domain name" $ip.txt`;
	$domain =~ s/\n//g; 	
	$domain =~ s/|   Domain name://g; 

	#Extraer OS:
	my $OS = `grep --color=never "OS:" $ip.txt`;
	$OS =~ s/\n//g; 	
	$OS =~ s/|   OS://g; 
	$OS =~ s/Windows 5.1/Windows XP/g; 
	
	my $info ="$ip;$name;$domain;$Workgroup;$OS\n";
	$info =~ s/\||\\x00//g; 
	
	open (SALIDA,">>../reportes/reporte-OS.txt") || die "ERROR: No puedo abrir el fichero\n";
	print SALIDA $info;
	close (SALIDA);
 # }
  #else
  #{print "$ip.txt does not exist\n";}
}
