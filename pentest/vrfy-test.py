#!/usr/bin/env python
# simple smtp open relay checker.. that works! 
# check IP: https://www.abuseat.org/lookup.cgi?ip=200.87.94.36

import socket
import getopt
import sys
import re
import time


host = sys.argv[1]
port = int(sys.argv[2])
domain = sys.argv[3]


s = socket.socket()
s.settimeout(20)
s.connect((host,port))

try:
	banner = s.recv(512)
	#print banner
except socket.timeout:
	sys.exit()
		
msg = "EHLO mail.%s\n"  %(domain)
error = s.sendall(msg)
time.sleep(2) 
recv_data = s.recv(512) 
print recv_data

msg = "VRFY nonexist@%s\n"  %(domain)	
#msg = "expn all \n"
error = s.sendall(msg)
	
if error:
	print "\n[!] Hubo un error al ejecutar la prueba:", error
else:
	try:
		recv_data = s.recv(512)
		print recv_data					
	except socket.timeout:
		print "Error"
