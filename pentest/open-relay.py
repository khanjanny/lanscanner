#!/usr/bin/env python
# simple smtp open relay checker.. that works! 
# by brad a.

import socket
import getopt
import sys
import re
import time


host = sys.argv[1]
port = int(sys.argv[2])
domain = sys.argv[3]


s = socket.socket()
s.settimeout(20)
s.connect((host,port))

try:
	banner = s.recv(512)
	#print banner
except socket.timeout:
	sys.exit()
		
#telnet 169.168.167.2 25
#HELO fondeco.org
#MAIL FROM: prueba@fondeco.org
#RCPT TO: pticona@isb.com.bo
#DATA
#Este es un correo de prueba
#Subject: Prueba SMTP
#.
	
msg = "EHLO mail.%s\n"  %(domain)
error = s.sendall(msg)
recv_data = s.recv(512) 
time.sleep(1) 
print recv_data


msg = "MAIL FROM: <sistemas@%s>\n" %(domain)
error = s.sendall(msg)
recv_data = s.recv(512) 
print msg
time.sleep(1) 
print recv_data

msg = "RCPT TO: <pentetest@mailinator.com>\n"
print "\n"
print msg
error = s.sendall(msg)
recv_data = s.recv(512) 
time.sleep(2) 
print recv_data

msg = "DATA\n"
print "\n"
print msg
error = s.sendall(msg)
recv_data = s.recv(512) 
time.sleep(1) 
print recv_data

msg = "Este es un correo de prueba\n."
print "\n"
print msg
error = s.sendall(msg)
recv_data = s.recv(512) 
time.sleep(1) 
print recv_data
