#!/usr/bin/env python
# simple smtp open relay checker.. that works! 
# by brad a.

import socket
import getopt
import sys
import re
import time


host = sys.argv[1]
port = int(sys.argv[2])


s = socket.socket()
s.settimeout(20)
s.connect((host,port))

try:
	banner = s.recv(512)
	#print banner
except socket.timeout:
	sys.exit()
		
	
msg = "EHLO\n"
error = s.sendall(msg)
recv_data = s.recv(512) 
time.sleep(1) 

msg = "EHLO nmap.scanme.org\n"
error = s.sendall(msg)
recv_data = s.recv(512) 
time.sleep(1) 

msg = "RSET\n"
error = s.sendall(msg)
recv_data = s.recv(512) 
time.sleep(1) 

msg = "MAIL FROM:<>\n"
error = s.sendall(msg)
recv_data = s.recv(512) 
time.sleep(1) 

msg = "RCPT TO:<reslaytest@nmap.scanme.org>\n"
error = s.sendall(msg)
recv_data = s.recv(512) 
time.sleep(1) 

msg = "RSET\n"
error = s.sendall(msg)
recv_data = s.recv(512) 
time.sleep(1) 
	
if "250" in recv_data: 
	print "data: ",recv_data


