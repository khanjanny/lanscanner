#!/usr/bin/env python
# simple smtp open relay checker.. that works! 
# check IP: https://www.abuseat.org/lookup.cgi?ip=200.87.94.36

import socket
import getopt
import sys
import re
import time


host = sys.argv[1]
port = int(sys.argv[2])
correo = sys.argv[3]


s = socket.socket()
s.settimeout(20)
s.connect((host,port))

try:
	banner = s.recv(512)
	#print banner
except socket.timeout:
	sys.exit()
		
#telnet 169.168.167.2 25
#HELO fondeco.org
#MAIL FROM: prueba@fondeco.org
#RCPT TO: 
#DATA
#Este es un correo de prueba
#Subject: Prueba SMTP
#.
	
msg = "EHLO %s\n"  %(host)
error = s.sendall(msg)
time.sleep(1) 
recv_data = s.recv(512) 
print recv_data


#msg = "from: <%s>\n" %(correo)
msg = "MAIL FROM: <%s>\n" %(correo)
error = s.sendall(msg)
recv_data = s.recv(512) 
print msg
time.sleep(2) 
print recv_data

#msg = "to: <%s>\n" %(correo)
msg = "RCPT TO: <%s>\n" %(correo)
print "\n"
print msg
error = s.sendall(msg)
time.sleep(2) 
recv_data = s.recv(512) 
print recv_data

msg = "DATA\n"
print "\n"
print msg
error = s.sendall(msg)
time.sleep(5) 
recv_data = s.recv(512) 
print recv_data
time.sleep(5)
msg = "Este es un correo de prueba\n.\n"
print "\n"
print msg
error = s.sendall(msg)
time.sleep(5) 
recv_data = s.recv(512) 
print recv_data
