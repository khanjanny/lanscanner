#!/usr/bin/perl
use Getopt::Long;
use LWP::UserAgent;
use HTTP::Request;
$ENV{PERL_LWP_SSL_VERIFY_HOSTNAME} = 0;

GetOptions(
    'url=s'    => \my $url,
) or die usage();


sub usage { 
  
  print "Uso:  \n";
  print "Autor: Daniel Torres Sandi \n";
  print " phpinfo.pl -url http://192.168.2.1:80/?phpinfo\n";  
}	

my $browser = LWP::UserAgent->new;

$browser->timeout(5);
$browser->show_progress(0);
$browser->agent("Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko");


my $headers = HTTP::Headers->new;

#$headers->header('User-Agent' => $user_agent); 
#$browser->default_header('User-Agent' => $user_agent);

$headers->header('Accept-Language' => 'en-US,en;q=0.5'); 
$headers->header('Accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'); 
$headers->header('Connection' => 'keep-alive'); 
$headers->header('Accept-Encoding' => "gzip, deflat");

my $req = HTTP::Request->new(GET => $url, $headers);
$response = $browser->request($req);
my $content = $response->decoded_content;

$content =~ s/'/"/g; 

#open (SALIDA,">phpinfo.html") || die "ERROR: No puedo abrir el fichero google.html\n";
#print SALIDA $content;
#close (SALIDA);


if (! ($content =~ /PHP Version/m)){	 
	print "$url no es un archivo PHPinfo\n";
	die;
 }

my $System = "";
if ($content =~ /System/m){	 
	$content =~ /System <\/td><td class="v">(.*?)<\/td>/;
	$System = $1;
}

my $COMPUTERNAME = "";
if ($content =~ /COMPUTERNAME/m){	 
	$content =~ /COMPUTERNAME <\/td><td class="v">(.*?)<\/td>/;
	$COMPUTERNAME = $1; 
	if ($COMPUTERNAME eq ''){  
		$content =~ /SERVER\["COMPUTERNAME"\]<\/td><td class="v">(.*?)<\/td>/;
		$COMPUTERNAME = $1; 
	}
}

my $USERNAME = "";
if ($content =~ /USERNAME/m){	 
	$content =~ /USERNAME <\/td><td class="v">(.*?)<\/td>/;
	$USERNAME = $1; 
	if ($USERNAME eq ''){  
		$content =~ /SERVER\["USERNAME"\]<\/td><td class="v">(.*?)<\/td>/;
		$USERNAME = $1; 
	}
}

my $USERDOMAIN = "";
if ($content =~ /USERDOMAIN/m){	 
	$content =~ /USERDOMAIN <\/td><td class="v">(.*?)<\/td>/;
	$USERDOMAIN = $1; 
	if ($USERDOMAIN eq ''){  
		$content =~ /SERVER\["USERDOMAIN"\]<\/td><td class="v">(.*?)<\/td>/;
		$USERDOMAIN = $1; 
	}
}

my $HTTP_X_FORWARDED_SERVER = "";
if ($content =~ /HTTP_X_FORWARDED_SERVER/m){	 
	$content =~ /SERVER\["HTTP_X_FORWARDED_SERVER"\]<\/td><td class="v">(.*?)<\/td>/;
	$HTTP_X_FORWARDED_SERVER = $1;
}


my $APPL_PHYSICAL_PATH = "";
if ($content =~ /APPL_PHYSICAL_PATH/m){	 
	$content =~ /SERVER\["APPL_PHYSICAL_PATH"\]<\/td><td class="v">(.*?)<\/td>/;
	$APPL_PHYSICAL_PATH = $1;
}

my $SCRIPT_FILENAME = "";
if ($content =~ /SCRIPT_FILENAME/m){	 
	$content =~ /SERVER\["SCRIPT_FILENAME"\]<\/td><td class="v">(.*?)<\/td>/;
	$SCRIPT_FILENAME = $1;
}

my $DOCUMENT_ROOT = "";
if ($content =~ /DOCUMENT_ROOT/m){	 
	$content =~ /SERVER\["DOCUMENT_ROOT"\]<\/td><td class="v">(.*?)<\/td>/;
	$DOCUMENT_ROOT = $1;
}          


my $SERVER_SOFTWARE = "";
if ($content =~ /SERVER_SOFTWARE/m){	 
	$content =~ /SERVER\["SERVER_SOFTWARE"\]<\/td><td class="v">(.*?)<\/td>/;
	$SERVER_SOFTWARE = $1;
}  

my $REMOTE_ADDR = "";
if ($content =~ /REMOTE_ADDR/m){	 
	$content =~ /SERVER\["REMOTE_ADDR"\]<\/td><td class="v">(.*?)<\/td>/;
	$REMOTE_ADDR = $1;
}      

my $REMOTE_HOST = "";
if ($content =~ /REMOTE_HOST/m){	 
	$content =~ /SERVER\["REMOTE_HOST"\]<\/td><td class="v">(.*?)<\/td>/;
	$REMOTE_HOST = $1;
}

my $LOCAL_ADDR = "";
if ($content =~ /LOCAL_ADDR/m){	 
	$content =~ /SERVER\["LOCAL_ADDR"\]<\/td><td class="v">(.*?)<\/td>/;
	$LOCAL_ADDR = $1;
}

my $SERVER_ADDR = "";
if ($content =~ /SERVER_ADDR/m){	 
	$content =~ /SERVER\["SERVER_ADDR"\]<\/td><td class="v">(.*?)<\/td>/;
	$SERVER_ADDR = $1;
}

my $HTTP_X_FORWARDED_HOST = "";
if ($content =~ /HTTP_X_FORWARDED_HOST/m){	 
	$content =~ /SERVER\["HTTP_X_FORWARDED_HOST"\]<\/td><td class="v">(.*?)<\/td>/;
	$HTTP_X_FORWARDED_HOST = $1;
}


my $HTTP_HOST = "";
if ($content =~ /HTTP_HOST/m){	 
	$content =~ /SERVER\["HTTP_HOST"\]<\/td><td class="v">(.*?)<\/td>/;
	$HTTP_HOST = $1;
}

my $SERVER_ADMIN = "";
if ($content =~ /SERVER_ADMIN/m){	 
	$content =~ /SERVER\["SERVER_ADMIN"\]<\/td><td class="v">(.*?)<\/td>/;
	$SERVER_ADMIN = $1;
}


print "System:  $System \n" if ($System ne "");
print "USERNAME:  $USERNAME \n" if ($USERNAME ne "");
print "COMPUTERNAME:  $COMPUTERNAME \n" if ($COMPUTERNAME ne "");
print "DOMAIN (HTTP_X_FORWARDED_SERVER):  $HTTP_X_FORWARDED_SERVER \n" if ($HTTP_X_FORWARDED_SERVER ne "");
print "DOMAIN (USERDOMAIN):  $USERDOMAIN \n" if ($USERDOMAIN ne "");
print "PATH (APPL_PHYSICAL_PATH):  $APPL_PHYSICAL_PATH \n" if ($APPL_PHYSICAL_PATH ne "");
print "PATH (SCRIPT_FILENAME):  $SCRIPT_FILENAME \n" if ($SCRIPT_FILENAME ne "");
print "PATH (DOCUMENT_ROOT):  $DOCUMENT_ROOT \n" if ($DOCUMENT_ROOT ne "");
print "REMOTE_ADDR (IP proxy):  $REMOTE_ADDR \n" if ($REMOTE_ADDR ne "");
print "REMOTE_HOST (IP proxy):  $REMOTE_HOST \n" if ($REMOTE_HOST ne "");

print "SERVER_ADDR (IP interna):  $SERVER_ADDR \n" if ($SERVER_ADDR ne "");
print "LOCAL_ADDR (IP interna):  $LOCAL_ADDR \n" if ($LOCAL_ADDR ne "");
print "HTTP_X_FORWARDED_HOST (IP publica):  $HTTP_X_FORWARDED_HOST \n" if ($HTTP_X_FORWARDED_HOST ne "");
print "HTTP_HOST (IP publica):  $HTTP_HOST \n" if ($HTTP_HOST ne "");
print "SERVER_ADMIN:  $SERVER_ADMIN \n" if ($SERVER_ADMIN ne "");


		
