#!/usr/bin/perl
use strict;       
use Net::FTP;
use Getopt::Std;


my %opts;
getopts('t:f:h', \%opts);

my $target = $opts{'t'} if $opts{'t'};
my $file = $opts{'f'} if $opts{'f'};
#my $port = $opts{'p'} if $opts{'p'};

#my $host = "186.121.211.212";


sub usage
{
  printf "\nUsage :\n";
  printf "perl ftp-anonymous.pl -t {ip} -f {file} \n\n";
  printf "";  
  exit(1);
}

# Print help message if required
if ($opts{'h'} || !(%opts)) {
	usage();
	exit 0;
}

my $ftp = Net::FTP->new($target,Timeout => 15) or die;
$ftp->login("anonymous",'anonymous') or die;
sleep 2;
print "Anonymous login \n\n";
print "Directory list: \n";
$ftp->passive("PASSIVE");


my @files = $ftp->ls;
foreach my $line (@files){
print $line,"\n";
}

$ftp->put($file) or die ;

my @files = $ftp->ls;
foreach my $line (@files){
 if($line =~ /$file/m){
    print "UPLOAD-ALLOWED \n";
 }
}

$ftp->delete($file);
$ftp->quit;

