#!/usr/bin/env perl
use strict; 
use warnings;
use Data::Dumper;
use Getopt::Std;


my %opts;
getopts('l:t:u:', \%opts);

my $ip_list = $opts{'l'} if $opts{'l'}; #all live hosts
my $scan_file_tcp = $opts{'t'} if $opts{'t'}; #all live hosts
my $scan_file_udp = $opts{'u'} if $opts{'u'}; #all live hosts


open (MYINPUT,"<$ip_list") || die "ERROR: Can not open the file $ip_list\n";
while (my $ip=<MYINPUT>)
{ 
$ip =~ s/\n//g; 	

#my $ports_open = `grep "$ip ()" $scan_file | grep -o open/tcp | wc -l`;
my $ports_open =  "\tTCP: ".`grep "$ip ()" $scan_file_tcp | grep -o "[0-9][0-9]*/open" | tr '\n' ',	' | tr -d '/open'`;
chop($ports_open); # delete last char ','

$ports_open = $ports_open . "\tUDP: ".`grep "$ip ()" $scan_file_udp | grep -o "[0-9][0-9]*/open/" | tr '\n' ',	' | tr -d '/open/'`;
chop($ports_open); # delete last char ','
#$ports_open

open (SALIDA,">>../reports/NMAP-report.txt") || die "ERROR: No puedo abrir el fichero ../reports/NMAP-report.txt\n";
print SALIDA "$ip $ports_open\n";
close (SALIDA);



}
