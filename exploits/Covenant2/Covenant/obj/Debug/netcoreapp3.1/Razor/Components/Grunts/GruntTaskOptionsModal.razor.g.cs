#pragma checksum "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "407fa6d1f686b288d25b4a7dc9a068f462b336fb"
// <auto-generated/>
#pragma warning disable 1591
namespace Covenant.Components.Grunts
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
#nullable restore
#line 1 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/_Imports.razor"
using Microsoft.AspNetCore.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/_Imports.razor"
using Covenant.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
using System.IO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
using System.Threading;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
using System.Threading.Tasks;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
using BlazorInputFile;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
using Covenant.Core;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
using Covenant.Models.Grunts;

#line default
#line hidden
#nullable disable
    public partial class GruntTaskOptionsModal : OwningComponentBase<ICovenantService>
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
            __builder.OpenElement(0, "div");
            __builder.AddAttribute(1, "class", "modal fade");
            __builder.AddAttribute(2, "id", "file-modal");
            __builder.AddAttribute(3, "tabindex", "-1");
            __builder.AddAttribute(4, "role", "dialog");
            __builder.AddAttribute(5, "aria-labelledby", "file-modal-label");
            __builder.AddAttribute(6, "aria-hidden", "true");
            __builder.AddMarkupContent(7, "\n    ");
            __builder.OpenElement(8, "div");
            __builder.AddAttribute(9, "class", "modal-dialog");
            __builder.AddAttribute(10, "role", "document");
            __builder.AddMarkupContent(11, "\n        ");
            __builder.OpenElement(12, "div");
            __builder.AddAttribute(13, "class", "modal-content");
            __builder.AddMarkupContent(14, "\n            ");
            __builder.AddMarkupContent(15, @"<div class=""modal-header"">
                <h5 class=""modal-title"" id=""file-modal-label"">Select File</h5>
                <button type=""button"" class=""close"" data-dismiss=""modal"" aria-label=""Close"">
                    <span aria-hidden=""true"">&times;</span>
                </button>
            </div>
            ");
            __builder.OpenElement(16, "div");
            __builder.AddAttribute(17, "class", "modal-body");
            __builder.AddMarkupContent(18, "\n");
#nullable restore
#line 22 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                 if (this.GruntTask != null)
                {
                    

#line default
#line hidden
#nullable disable
#nullable restore
#line 24 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                     for (int i = 0; i < this.GruntTask.Options.Count; i++)
                    {
                        int number = i;
                        

#line default
#line hidden
#nullable disable
#nullable restore
#line 27 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                         if (this.GruntTask.Options[number].FileOption)
                        {

#line default
#line hidden
#nullable disable
            __builder.AddContent(19, "                            ");
            __builder.OpenElement(20, "div");
            __builder.AddAttribute(21, "class", "form-group");
            __builder.AddMarkupContent(22, "\n                                ");
            __builder.OpenElement(23, "label");
            __builder.AddAttribute(24, "for", 
#nullable restore
#line 30 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                             GruntTask.Options[number].Name

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(25, 
#nullable restore
#line 30 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                                                              GruntTask.Options[number].Name

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(26, "<br>\n                                ");
            __builder.OpenComponent<BlazorInputFile.InputFile>(27);
            __builder.AddAttribute(28, "id", 
#nullable restore
#line 31 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                                                 GruntTask.Options[number].Name

#line default
#line hidden
#nullable disable
            );
            __builder.AddAttribute(29, "OnChange", Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<Microsoft.AspNetCore.Components.EventCallback<BlazorInputFile.IFileListEntry[]>>(Microsoft.AspNetCore.Components.EventCallback.Factory.Create<BlazorInputFile.IFileListEntry[]>(this, 
#nullable restore
#line 31 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                                                                                           OnUpload

#line default
#line hidden
#nullable disable
            )));
            __builder.AddComponentReferenceCapture(30, (__value) => {
#nullable restore
#line 31 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                                 InputFile = (BlazorInputFile.InputFile)__value;

#line default
#line hidden
#nullable disable
            }
            );
            __builder.CloseComponent();
            __builder.AddMarkupContent(31, "\n");
#nullable restore
#line 32 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                 if (this.UploadInProgress)
                                {

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(32, "                                    <span class=\"fe fe-loader spin\"></span>\n");
#nullable restore
#line 35 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                }

#line default
#line hidden
#nullable disable
#nullable restore
#line 36 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                 if (string.IsNullOrEmpty(this.ErrorMessage))
                                {

#line default
#line hidden
#nullable disable
            __builder.AddContent(33, "                                    ");
            __builder.OpenElement(34, "span");
            __builder.AddAttribute(35, "class", "text-danger");
            __builder.AddContent(36, 
#nullable restore
#line 38 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                                               ErrorMessage

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(37, "\n");
#nullable restore
#line 39 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                }

#line default
#line hidden
#nullable disable
            __builder.AddContent(38, "                            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(39, "\n");
#nullable restore
#line 41 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                        }
                        else
                        {

#line default
#line hidden
#nullable disable
            __builder.AddContent(40, "                            ");
            __builder.OpenElement(41, "div");
            __builder.AddAttribute(42, "class", "form-group");
            __builder.AddMarkupContent(43, "\n                                ");
            __builder.OpenElement(44, "label");
            __builder.AddAttribute(45, "for", 
#nullable restore
#line 45 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                             GruntTask.Options[number].Name

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(46, 
#nullable restore
#line 45 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                                                              GruntTask.Options[number].Name

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(47, "\n                                ");
            __builder.OpenElement(48, "input");
            __builder.AddAttribute(49, "id", 
#nullable restore
#line 46 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                            GruntTask.Options[number].Name

#line default
#line hidden
#nullable disable
            );
            __builder.AddAttribute(50, "name", 
#nullable restore
#line 46 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                                                                   GruntTask.Options[number].Name

#line default
#line hidden
#nullable disable
            );
            __builder.AddAttribute(51, "class", "form-control");
            __builder.AddAttribute(52, "value", Microsoft.AspNetCore.Components.BindConverter.FormatValue(
#nullable restore
#line 46 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                                                                                                          GruntTask.Options[number].Value

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(53, "onchange", Microsoft.AspNetCore.Components.EventCallback.Factory.CreateBinder(this, __value => GruntTask.Options[number].Value = __value, GruntTask.Options[number].Value));
            __builder.SetUpdatesAttributeName("value");
            __builder.CloseElement();
            __builder.AddMarkupContent(54, "\n                            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(55, "\n");
#nullable restore
#line 48 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                        }

#line default
#line hidden
#nullable disable
#nullable restore
#line 48 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                         
                    }

#line default
#line hidden
#nullable disable
#nullable restore
#line 49 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                     
                }

#line default
#line hidden
#nullable disable
            __builder.AddContent(56, "            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(57, "\n            ");
            __builder.OpenElement(58, "div");
            __builder.AddAttribute(59, "class", "modal-footer");
            __builder.AddMarkupContent(60, "\n                ");
            __builder.AddMarkupContent(61, "<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\n                ");
            __builder.OpenElement(62, "button");
            __builder.AddAttribute(63, "type", "button");
            __builder.AddAttribute(64, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 54 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
                                                Execute

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(65, "class", "btn btn-primary");
            __builder.AddContent(66, "Execute");
            __builder.CloseElement();
            __builder.AddMarkupContent(67, "\n            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(68, "\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(69, "\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(70, "\n");
            __builder.CloseElement();
        }
        #pragma warning restore 1998
#nullable restore
#line 60 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntTaskOptionsModal.razor"
       
    [Parameter]
    public EventCallback<GruntTask> OnSubmit { get; set; }

    private GruntTask GruntTask { get; set; }
    private InputFile InputFile { get; set; }
    private IList<MemoryStream> UploadedFiles { get; set; }
    private SemaphoreSlim UploadSemaphore { get; set; } = new SemaphoreSlim(1, 1);
    private bool UploadInProgress { get; set; } = false;

    public async Task Show(GruntTask task)
    {
        this.GruntTask = task;
        this.StateHasChanged();
        await IJSRuntime.InvokeAsync<string>("ActivateModal", "#file-modal");
    }

    private async Task Execute()
    {
        await UploadSemaphore.WaitAsync();
        if (this.UploadedFiles != null && this.GruntTask.Options.Any(O => O.FileOption && string.IsNullOrEmpty(O.Value)))
        {
            this.OnRead(this.UploadedFiles);
        }
        UploadSemaphore.Release();
        await IJSRuntime.InvokeAsync<string>("ModalCommand", "#file-modal", "hide");
        await OnSubmit.InvokeAsync(GruntTask);
    }

    private string ErrorMessage { get; set; }
    private async Task OnUpload(IFileListEntry[] files)
    {
        try
        {
            await UploadSemaphore.WaitAsync();
            this.UploadInProgress = true;
            this.StateHasChanged();
            this.UploadedFiles = new List<MemoryStream>();
            for (int i = 0; i < files.Length; i++)
            {
                if (files[i] != null)
                {
                    MemoryStream ms = new MemoryStream();
                    await files[i].Data.CopyToAsync(ms);
                    this.UploadedFiles.Add(ms);
                    this.OnRead(this.UploadedFiles);
                }
            }
        }
        catch (Exception e)
        {
            this.ErrorMessage = e.Message;
        }
        this.UploadInProgress = false;
        this.StateHasChanged();
        UploadSemaphore.Release();
    }

    private void OnRead(IList<MemoryStream> Streams)
    {
        try
        {
            for (int i = 0; i < Streams.Count(); i++)
            {
                GruntTaskOption option = this.GruntTask.Options.Where(O => O.FileOption).ToList()[i];
                option.Value = Convert.ToBase64String(Streams[i].ToArray());
                this.UploadedFiles[i] = new MemoryStream(Convert.FromBase64String(option.Value));
            }
        }
        catch (Exception e)
        {
            this.ErrorMessage = e.Message;
            this.StateHasChanged();
        }
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime IJSRuntime { get; set; }
    }
}
#pragma warning restore 1591
