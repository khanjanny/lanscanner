#pragma checksum "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "b033e57a2df5f0985d054003f24b7f9004687a1f"
// <auto-generated/>
#pragma warning disable 1591
namespace Covenant.Components.Grunts
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Threading.Tasks;
#nullable restore
#line 1 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/_Imports.razor"
using Microsoft.AspNetCore.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/_Imports.razor"
using Covenant.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
using System.IO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
using System.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
using Covenant.Core;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
using Covenant.Models.Grunts;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
using Covenant.Models.Covenant;

#line default
#line hidden
#nullable disable
    public partial class GruntCommandCard : OwningComponentBase<ICovenantService>, IDisposable
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
            __builder.OpenElement(0, "div");
            __builder.AddAttribute(1, "class", "card task-card interact-style interact-border w-100");
            __builder.AddAttribute(2, "id", "tasking-card-" + (
#nullable restore
#line 13 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                   GruntCommand.Id

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(3, "\n    ");
            __builder.OpenElement(4, "div");
            __builder.AddAttribute(5, "class", "d-flex flex-row");
            __builder.AddMarkupContent(6, "\n        ");
            __builder.OpenElement(7, "div");
            __builder.AddAttribute(8, "class", "col-auto p-0");
            __builder.AddMarkupContent(9, "\n            ");
            __builder.OpenElement(10, "a");
            __builder.AddAttribute(11, "class", "expand-button p-0");
            __builder.AddAttribute(12, "type", "button");
            __builder.AddAttribute(13, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 16 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                 OnToggle

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(14, "\n");
#nullable restore
#line 17 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                 if (this.IsMinimized)
                {

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(15, "                    <span class=\"fe fe-plus text-muted font-weight-bold\"></span>\n");
#nullable restore
#line 20 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                }
                else
                {

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(16, "                    <span class=\"fe fe-minus text-muted font-weight-bold\"></span>\n");
#nullable restore
#line 24 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                }

#line default
#line hidden
#nullable disable
            __builder.AddContent(17, "            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(18, "\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(19, "\n        ");
            __builder.OpenElement(20, "div");
            __builder.AddAttribute(21, "class", "col-auto pl-0 pr-2");
            __builder.AddMarkupContent(22, "\n");
#nullable restore
#line 28 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
             if (GruntCommand.GruntTasking == null)
            {

#line default
#line hidden
#nullable disable
            __builder.AddContent(23, "                ");
            __builder.OpenElement(24, "p");
            __builder.AddAttribute(25, "class", "terminal-highlight-color task-text-head");
            __builder.AddContent(26, "[");
            __builder.AddContent(27, 
#nullable restore
#line 30 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                     GruntCommand.CommandTime

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(28, " UTC] Command submitted");
            __builder.CloseElement();
            __builder.AddMarkupContent(29, "\n");
#nullable restore
#line 31 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
            }
            else
            {

#line default
#line hidden
#nullable disable
            __builder.AddContent(30, "                ");
            __builder.OpenElement(31, "p");
            __builder.AddAttribute(32, "class", "terminal-highlight-color task-text-head");
            __builder.AddContent(33, "[");
            __builder.AddContent(34, 
#nullable restore
#line 34 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                     GruntCommand.CommandTime

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(35, " UTC] ");
            __builder.AddContent(36, 
#nullable restore
#line 34 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                                    GruntCommand.GruntTasking.GruntTask.Name

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(37, " ");
            __builder.AddContent(38, 
#nullable restore
#line 34 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                                                                              GruntCommand.GruntTasking.Status.ToString().ToLower()

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(39, "\n");
#nullable restore
#line 35 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
            }

#line default
#line hidden
#nullable disable
            __builder.AddContent(40, "            ");
            __builder.OpenElement(41, "p");
            __builder.AddAttribute(42, "class", "terminal-text-color task-text-body");
            __builder.AddContent(43, "(");
            __builder.OpenElement(44, "b");
            __builder.AddContent(45, 
#nullable restore
#line 36 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                               GruntCommand.User.UserName

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddContent(46, ") > ");
            __builder.AddContent(47, 
#nullable restore
#line 36 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                                  GruntCommand.Command

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(48, "\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(49, "\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(50, "\n    ");
            __builder.OpenElement(51, "div");
            __builder.AddAttribute(52, "class", "card-header p-0 border-top-0 border-bottom-0");
            __builder.AddAttribute(53, "id", "tasking-header-" + (
#nullable restore
#line 39 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                  GruntCommand.Id

#line default
#line hidden
#nullable disable
            ));
            __builder.CloseElement();
            __builder.AddMarkupContent(54, "\n");
#nullable restore
#line 40 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
     if (!this.IsMinimized)
    {

#line default
#line hidden
#nullable disable
            __builder.AddContent(55, "        ");
            __builder.OpenElement(56, "div");
            __builder.AddAttribute(57, "class", "card-body interact-style");
            __builder.AddMarkupContent(58, "\n");
#nullable restore
#line 43 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
             if (GruntCommand.CommandOutput != null)
            {
                if (GruntCommand.GruntTasking != null && GruntCommand.GruntTasking.GruntTask != null && GruntCommand.GruntTasking.GruntTask.Name == "ScreenShot")
                {
                    if (GruntCommand.GruntTasking.Status == GruntTaskingStatus.Progressed)
                    {

#line default
#line hidden
#nullable disable
            __builder.OpenElement(59, "p");
            __builder.AddAttribute(60, "class", "terminal-text-color task-text-body");
            __builder.AddAttribute(61, "style", "white-space:pre-wrap");
            __builder.AddContent(62, "Downloading screenshot... ");
            __builder.AddContent(63, 
#nullable restore
#line 48 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                                                           GruntCommand.CommandOutput.Output.Length

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(64, " bytes");
            __builder.CloseElement();
#nullable restore
#line 48 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                                                                                                             }
                    else if (GruntCommand.GruntTasking.Status == GruntTaskingStatus.Completed)
                    {

#line default
#line hidden
#nullable disable
            __builder.OpenElement(65, "img");
            __builder.AddAttribute(66, "style", "max-width: 100%");
            __builder.AddAttribute(67, "src", "data:image/png;base64," + " " + (
#nullable restore
#line 50 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                               GruntCommand.CommandOutput.Output

#line default
#line hidden
#nullable disable
            ));
            __builder.CloseElement();
#nullable restore
#line 50 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                                                    }
                }
                else if (GruntCommand.GruntTasking != null && GruntCommand.GruntTasking.GruntTask != null && GruntCommand.GruntTasking.GruntTask.Name == "Download")
                {
                    if (GruntCommand.GruntTasking.Status == GruntTaskingStatus.Progressed)
                    {

#line default
#line hidden
#nullable disable
            __builder.OpenElement(68, "p");
            __builder.AddAttribute(69, "class", "terminal-text-color task-text-body");
            __builder.AddAttribute(70, "style", "white-space:pre-wrap");
            __builder.AddContent(71, "Downloading... ");
            __builder.AddContent(72, 
#nullable restore
#line 55 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                                                GruntCommand.CommandOutput.Output.Length

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(73, " bytes");
            __builder.CloseElement();
#nullable restore
#line 55 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                                                                                                  }
                    else if (GruntCommand.GruntTasking.Status == GruntTaskingStatus.Completed)
                    {DownloadEvent downloadEvent = GetDownloadEvent(GruntCommand).WaitResult();

#line default
#line hidden
#nullable disable
            __builder.OpenElement(74, "p");
            __builder.AddAttribute(75, "class", "text-white task-text-body");
            __builder.AddAttribute(76, "style", "white-space:pre-wrap");
            __builder.AddContent(77, "Download completed: ");
#nullable restore
#line 57 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                                                                                                                      if (downloadEvent != null){

#line default
#line hidden
#nullable disable
            __builder.OpenElement(78, "button");
            __builder.AddAttribute(79, "type", "button");
            __builder.AddAttribute(80, "class", "btn btn-link text-white task-text-body");
            __builder.AddAttribute(81, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 57 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                                                                                                                                                                                                                                (e => OnDownload(downloadEvent))

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(82, 
#nullable restore
#line 57 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                                                                                                                                                                                                                                                                   downloadEvent.FileName

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
#nullable restore
#line 57 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                                                                                                                                                                                                                                                                                                  }

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
#nullable restore
#line 57 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                                                                                                                                                                                                                                                                                                       }
                }
                else
                {

#line default
#line hidden
#nullable disable
            __builder.AddContent(83, "                    ");
            __builder.OpenElement(84, "p");
            __builder.AddAttribute(85, "class", "terminal-text-color task-text-body");
            __builder.AddAttribute(86, "style", "white-space:pre-wrap");
            __builder.AddContent(87, 
#nullable restore
#line 61 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                                                                                                GruntCommand.CommandOutput.Output

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(88, "\n");
#nullable restore
#line 62 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
                }
            }
            else
            {

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(89, "                <p class=\"terminal-text-color task-text-body\" style=\"white-space:pre-wrap\"></p>\n");
#nullable restore
#line 67 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
            }

#line default
#line hidden
#nullable disable
            __builder.AddContent(90, "        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(91, "\n");
#nullable restore
#line 69 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
    }

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
        }
        #pragma warning restore 1998
#nullable restore
#line 72 "/root/nk/Github/lanscanner/exploits/Covenant/Covenant/Components/Grunts/GruntCommandCard.razor"
       
    [Parameter]
    public int GruntCommandId { get; set; }
    private GruntCommand GruntCommand { get; set; }

    [Parameter]
    public bool IsMinimized { get; set; } = true;

    protected override async Task OnInitializedAsync()
    {
        this.GruntCommand = await Service.GetGruntCommand(this.GruntCommandId);
        this.GruntCommand.CommandOutput ??= await Service.GetCommandOutput(this.GruntCommand.CommandOutputId);
        Service.DisposeContext();
        this.INotificationService.OnEditGruntCommand += OnEditGruntCommand;
        this.INotificationService.OnEditCommandOutput += OnEditCommandOutput;
        this.INotificationService.OnEditGruntTasking += OnEditGruntTasking;
    }

    public void Dispose()
    {
        this.INotificationService.OnEditGruntCommand -= OnEditGruntCommand;
        this.INotificationService.OnEditCommandOutput -= OnEditCommandOutput;
        this.INotificationService.OnEditGruntTasking -= OnEditGruntTasking;
    }

    private async void OnEditCommandOutput(object sender, CommandOutput commandOutput)
    {
        if (this.GruntCommand.CommandOutput != null && this.GruntCommand.CommandOutput.Id == commandOutput.Id)
        {
            this.GruntCommand = await Service.GetGruntCommand(this.GruntCommandId);
            Service.DisposeContext();
            this.GruntCommand.CommandOutput ??= await Service.GetCommandOutput(this.GruntCommand.CommandOutputId);
            Service.DisposeContext();
            await this.InvokeAsync(() => this.StateHasChanged());
        }
    }

    private async void OnEditGruntCommand(object sender, GruntCommand gruntCommand)
    {
        if (this.GruntCommandId == gruntCommand.Id)
        {
            this.GruntCommand = await Service.GetGruntCommand(this.GruntCommandId);
            Service.DisposeContext();
            this.GruntCommand.CommandOutput ??= await Service.GetCommandOutput(this.GruntCommand.CommandOutputId);
            Service.DisposeContext();
            await this.InvokeAsync(() => this.StateHasChanged());
        }
    }

    private async void OnEditGruntTasking(object sender, GruntTasking gruntTasking)
    {
        if (this.GruntCommand.GruntTasking != null && this.GruntCommand.GruntTasking.Id == gruntTasking.Id)
        {
            this.GruntCommand = await Service.GetGruntCommand(this.GruntCommandId);
            this.GruntCommand.CommandOutput ??= await Service.GetCommandOutput(this.GruntCommand.CommandOutputId);
            Service.DisposeContext();
            await this.InvokeAsync(() => this.StateHasChanged());
        }
    }

    private async Task OnToggle()
    {
        if (this.IsMinimized && this.GruntCommand.CommandOutput == null)
        {
            this.GruntCommand = await Service.GetGruntCommand(this.GruntCommand.Id);
            Service.DisposeContext();
        }
        this.IsMinimized = !IsMinimized;
    }

    private async Task<DownloadEvent> GetDownloadEvent(GruntCommand command)
    {
        if (GruntCommand.GruntTasking != null && GruntCommand.CommandOutput != null)
        {
            IEnumerable<DownloadEvent> downloadEvents = await Service.GetDownloadEvents();
            Service.DisposeContext();
            return downloadEvents
            .FirstOrDefault(DE => DE.Time == command.GruntTasking.CompletionTime && DE.FileContents == command.CommandOutput.Output);
        }
        return null;
    }

    private async Task OnDownload(DownloadEvent downloadEvent)
    {
        if (!Common.ContentTypeMappings.TryGetValue(Path.GetExtension(downloadEvent.FileName), out string contentType))
        {
            contentType = Common.DefaultContentTypeMapping;
        }
        await IJSRuntime.InvokeAsync<string>(
            "DownloadFile",
            Path.GetFileName(downloadEvent.FileName),
            contentType,
            downloadEvent.FileContents
        );
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime IJSRuntime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private INotificationService INotificationService { get; set; }
    }
}
#pragma warning restore 1591
